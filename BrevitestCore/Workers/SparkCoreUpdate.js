var spark = require('sparkCore');var updateCount = 0;var updateStatusInterval;             function updateOneCore(core) {	var a, d, s;		if (core.connected) {		d = ds.Device.find('sparkCoreID === :1', core.id);		if (d) {			d.online = core.connected;			d.sparkName = core.name;			d.sparkLastHeard = core.last_heard;			d.save();		}				s = spark.get_status(core.id);		if (s.success) {			d.status = s.success ? s.value : 'Status unavailable';			d.save();		}				a = spark.assay_running(core.id);		if (a.success) {			if (a.value) {				t = ds.Test.find('ID === :1', a.value);				if (t) {					t.status = s.success ? s.value : 'Status unavailable';				}				core.available = false;			}			else {				core.available = true;			}		}		else {			core.available = false;		}	}	else {		d = ds.Device.find('sparkCoreID === :1', core.id);		if (d) {			d.online = false;			d.status = 'Status unavailable';			d.save();		}	}}function updateOneTest(test, cores) {	var core, i;		for (i = 0; i < cores.length; i += 1) {		core = cores[i];		if (core.connected && core.available && (core.id === test.sparkCoreID)) { // grab test info					}	}}function doUpdateStatus(){	updateCount += 1;	var datetime = new Date();	console.log('Update ' + updateCount + ': ' + datetime.toString());	console.log('get_list_of_cores: ' + result);	var result = spark.get_list_of_cores();	if (result.success) {		result.response.forEach(updateOneCore);		var tests = ds.Test.query('startedOn !== null AND finishedOn === null');		tests.forEach(updateOneTest, result.response);	}	else {		console.log(updateCount + ': Spark API not available on ' + dt.toString());	}} onconnect = function(msg){    var thePort = msg.ports[0];        console.log('In onconnect');        thePort.postMessage("OK");}console.log('Start of updating...');              doUpdateStatus();  //  Initial update so that there is not a delay at server startup timeupdateStatusInterval = setInterval(doUpdateStatus, 10000); //  Perform update every 2 minutes