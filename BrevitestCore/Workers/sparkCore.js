function doSomeWork() {    try {        // do something        tmCount += 1;    }    catch (e) {        tmError = 1;    }}onconnect = function(msg) // called when a new SharedWorker is created{    var thePort = msg.ports[0];    tmKey += 1;    tmConnections[tmKey] = thePort;    thePort.onmessage = function(event) {        var message = event.data;        var fromPort = tmConnections[message.ref];        switch (message.type) {        case 'validate':            if (tmError != 0) {                fromPort.postMessage({                    type: 'error',                    errorCode: tmError                });                close();            }            else {                fromPort.postMessage({                    type: 'update',                    count: tmCount                });            }            break;                    case 'sensor_output':        	        	break;        case 'disconnect':            tmConnections[message.ref] = null;            break;        }    };        thePort.postMessage({        type: 'connected',        ref: tmKey    });}var tmCount = 0;var tmKey = 0;var tmError = 0;var tmConnections = [];setInterval(doSomeWork, 1000) //Run every second